---
layout: post
title: Loguru â€”â€” An Enjoyable Logging Library
categories: [Python]
description: loguruä½¿ç”¨ä»‹ç»
keywords: Python, Loguru
---

# Loguru
## Loguruæ˜¯ä»€ä¹ˆ
`Loguru is a library which aims to bring enjoyable logging in Python.`å®˜æ–¹åŸè¯ã€‚   
emmm...è‹±è¯­æ¸£æ¸£å°±ä¸ç¿»è¯‘äº†ã€‚
ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªæ“ä½œæ—¥å¿—çš„åº“ã€‚ä½†æ˜¯ä¸ç”¨åƒloggingé‚£æ ·æ¯æ¬¡å†™å„ç§é…ç½®ï¼Œä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼ŒåŒæ—¶ç”±äºé›†æˆäº†`colorama`,`better_exceptions`ç­‰åº“ï¼Œä½¿å¾—åœ¨æ ¼å¼åŒ–è¾“å‡ºä»¥åŠå¼‚å¸¸å¤„ç†æ–¹é¢éƒ½å¾ˆå‡ºè‰²ã€‚

## å®‰è£…
pip install loguru

## ä½¿ç”¨  

- æ— éœ€é…ç½®å³å¯ä½¿ç”¨
  ```Python
  from loguru import logger
  logger.debug("this is a debug message")
  logger.info("this is an info message")
  logger.error("this is an error message")
  logger.warning("this is a warning message")
  ```
- è¾“å‡ºåˆ°æ–‡ä»¶ä¸­
  ```Python
  logger.add("test.log")
  logger.debug("this is a debug message")
  logger.info("this is an info message")
  logger.error("this is an error message")
  logger.warning("this is a warning message")
  ```
- æ”¯æŒæ—¥å¿—rotationå¾ªç¯ï¼Œretentionä¿ç•™ï¼Œcompressionå‹ç¼©
  é€šè¿‡`rotation`å‚æ•°ï¼Œå¯æ§åˆ¶æ—¥å¿—çš„åˆ›å»ºï¼Œæ¯”å¦‚å¯ä»¥æ ¹æ®æ—¶é—´åˆ›å»ºï¼Œæˆ–è€…æ ¹æ®å¤§å°æ¥åˆ›å»º
  é€šè¿‡`retention`å‚æ•°ï¼Œå¯ä»¥å®ç°å®šæœŸæ¸…ç†æ—¥å¿—
  é€šè¿‡`compression`å‚æ•°ï¼Œå¯ä»¥å®ç°æ—¥å¿—çš„å‹ç¼©
  ```Python
  logger.add("file_1.log", rotation="500 MB")    # Automatically rotate too big file
  logger.add("file_2.log", rotation="12:00")     # New file is created each day at noon
  logger.add("file_3.log", rotation="1 week")    # Once the file is too old, it's rotated
  logger.add("file_X.log", retention="10 days")  # Cleanup after some time
  logger.add("file_Y.log", compression="zip")    # Save some loved space
  ```
- æ”¯æŒå­—ç¬¦ä¸²æ ¼å¼åŒ–
  ```Python
  logger.info("this is a {level} message, comes from {comefrom}", level='info', comefrom="loguru")
  ```
  ä½¿ç”¨æ–¹æ³•ç±»ä¼¼äºstr.format()ã€‚   
  å½“ç„¶ï¼Œå¦‚æœPythonç‰ˆæœ¬å¤§äºç­‰äº3.6ï¼Œè¿˜æ˜¯æ¨èf-stringæ ¼å¼

- æ”¯æŒå¼‚å¸¸æ•è·
  ```Python
  @logger.catch
  def devide_by_zero(x):
      return x/0

  devide_by_zero(6)
  ```
  ä¼šè¾“å‡ºå…·ä½“å¼‚å¸¸ä»¥åŠå¼‚å¸¸æ ˆ
  ```
  Traceback (most recent call last):
  
  > File "d:/test_loguru.py", line 19, in <module>
      devide_by_zero(6)
      â”” <function devide_by_zero at 0x00000112BDAE1158>
  
    File "d:/test_loguru.py", line 17, in devide_by_zero
      return x/0
             â”” 6
  
  ZeroDivisionError: division by zero
  ```

- å¤šç§é¢œè‰²è¾“å‡º  
  ç”±äºé›†æˆäº†coloramaï¼Œå¯ä»¥å®ç°å„ç§é¢œè‰²çš„è¾“å‡ºæ ¼å¼
- å¼‚æ­¥ã€çº¿ç¨‹å®‰å…¨
  logurué»˜è®¤çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡`enqueue`çš„æ–¹å¼æ¥è¾¾åˆ°å¤šè¿›ç¨‹å®‰å…¨çš„ç›®çš„
  `logger.add("somefile.log", enqueue=True)`
- æ”¯æŒå¼‚å¸¸æè¿°ï¼Œè·Ÿè¸ªæ ˆ
  é›†æˆäº†better_exceptionsåº“ï¼Œä½¿å¾—å¯ä»¥è¾“å‡ºè¯¦ç»†çš„å¼‚å¸¸ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿæ‰¾åˆ°é—®é¢˜
- æ”¯æŒè‡ªå®šä¹‰level
  loguruå®šä¹‰äº†7ä¸ªlevel, åˆ†åˆ«æ˜¯ï¼šTRACE, DEBUG, INFO, SUCCESS, WARNING, ERROR, CRITICALã€‚
  ```Python
  new_level = logger.level("SNAKY", no=38, color="<yellow>", icon="ğŸ")
  logger.log("SNAKY", "Here we go!")
  ```
- å¯¹æ—¥æœŸæ”¯æŒæ›´å¥½
- å®Œå…¨å…¼å®¹logging
- æ”¯æŒæ—¥å¿—è§£æ
  å¯ä»¥ä½¿ç”¨`logger.parse`æ¥å¯¹å·²æœ‰çš„æ—¥å¿—è¿›è¡Œè§£æï¼Œè·å–å…³é”®ä¿¡æ¯

## é—®é¢˜æ±‡æ€»
- ### ä¸­æ–‡æ—¥å¿—ä¹±ç é—®é¢˜  
  åŠ ä¸Šencodingå‚æ•°  
  `logger.add("test.log", encoding='utf-8')`
  <br>
- ### å¦‚ä½•è‡ªå·²é€‰æ‹©ä»€ä¹ˆæ—¶å€™è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä»€ä¹ˆæ—¶å€™è¾“å‡ºåˆ°æ–‡ä»¶ä¸­  
  æ¯”å¦‚æ­£å¸¸çš„logä¿¡æ¯ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œé”™è¯¯æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ä¿å­˜
  - #### æ–¹æ³•1 é€šè¿‡levelæ¥æ§åˆ¶ï¼š
    å¯ä»¥é€šè¿‡`logger.add`æ–¹æ³•ä¸­çš„çš„`level`å‚æ•°æ¥æ§åˆ¶
    `level`å‚æ•°è§£é‡Šï¼š`The minimum severity level from which logged messages should be sent to the sink.`  
    å½“å°†è¦è¾“å‡ºçš„æ—¥å¿—levelé«˜äºæˆ–ç­‰äºä½ æ‰€è®¾ç½®çš„levelé˜ˆå€¼ï¼Œåˆ™ä¼šå°†è¿™äº›æ—¥å¿—éƒ½è¾“å‡ºåˆ°ä½ æœŸæœ›çš„åœ°æ–¹ã€‚
    
    æ‰€ä»¥å¦‚æœæƒ³è¦å®ç°ä¸Šé¢çš„åŠŸèƒ½ï¼Œåªéœ€è¦æŠŠlevelè®¾ç½®ä¸ºERRORï¼Œå³å¯å®ç°æ—¥å¿—æ–‡ä»¶ä¸­åªåŒ…å«ERRORå’ŒCRITICALã€‚
    ```Python
    logger.add("test.log", encoding='utf-8', level="ERROR")
    logger.trace("this is an trace message") # è¾“å‡ºåˆ°æ§åˆ¶å°
    logger.debug("this is an debug message") # è¾“å‡ºåˆ°æ§åˆ¶å°
    logger.info("this is an info message") # è¾“å‡ºåˆ°æ§åˆ¶å°
    logger.success("this is an success message") # è¾“å‡ºåˆ°æ§åˆ¶å°
    logger.warning("this is an warning message") # è¾“å‡ºåˆ°æ§åˆ¶å°
    logger.error("this is an error message") # åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶ä¸­
    logger.critical("this is an critical message") # åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶ä¸­
    ```
  - #### æ–¹æ³•2 é€šè¿‡filteræ¥æ§åˆ¶ï¼š
    `filter(callable, str or dict, optional)`å‚æ•°è§£é‡Š: `A directive optionally used to decide for each logged message whether it should be sent to the sink or not.`
    - callable
      å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œç»“åˆ`record`çš„ä¸€äº›å±æ€§æ¥è¿›è¡Œè¿‡æ»¤æ“ä½œ
      ä¾‹å¦‚åªæ˜¾ç¤ºinfoæ¶ˆæ¯
      ```Python
      >>> def only_info(record):
      ...     return record["level"].name == "INFO"
      ...
      >>> logger.add(sys.stdout, filter=only_info)
      2
      >>> logger.trace("this is an trace message")
      >>> logger.debug("this is an debug message")
      >>> logger.info("this is an info message")
      2020-06-08 14:14:39.079 | INFO     | __main__:<module>:1 - this is an info message
      >>> logger.success("this is an success message")
      >>> logger.warning("this is an warning message")
      >>> logger.error("this is an error message")
      >>> logger.critical("this is an critical message")
      ```
      åªæ˜¾ç¤ºå…·ä½“æŸä¸ªmodelçš„æ—¥å¿—ï¼š
      ```Python
      >>> def only_test_module(record):
      ...     return record["module"].name == "test_module"
      ...
      ```
    - str
    å½“filterä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œåªæœ‰æŒ‡å®šæ¨¡å—æˆ–è€…å…¶å­æ¨¡å—æ‰ä¼šè¢«è¾“å‡º
    `logger.add(sys.stdout, filter="test_module")`
    ä¸`only_test_module`åŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯æ›´ç®€æ´
    - dict
    ç›¸å½“äºä¸€ä¸ªé…ç½®è¡¨ï¼Œæ§åˆ¶å„ç§æ—¥å¿—è¾“å‡º
    ```Python
    level_per_module = {
    "": "DEBUG",
    "third.lib": "WARNING",
    "anotherlib": False
    }
    logger.add(lambda m: print(m, end=""), filter=level_per_module, level=0)
    ```
- ### ç§»é™¤/ä¿®æ”¹é»˜è®¤è¾“å‡º
  loggerä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œåœ¨ç”¨æˆ·å¯¼å…¥import loggerçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨ç»‘å®šä¸€ä¸ªé»˜è®¤`sink`ã€‚æ‰€ä»¥ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸æŒ‡å®š`sink`çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚ä½†æ˜¯å¦‚æœï¼Œå½“ä½ æ‰§è¡Œäº†ç±»ä¼¼`logger.add(sys.stdout, format="my log {message}")`æ–¹æ³•åï¼Œå±å¹•ä¼šå¤šå‡ºä¸¤æ¡è¾“å‡ºã€‚
  ```Python
  >>> from loguru import logger
  >>> import sys
  >>> logger.add(sys.stdout, format="my log {message}")
  1
  >>> logger.debug("debug message")
  2020-06-08 11:33:39.969 | DEBUG    | __main__:<module>:1 - debug message
  my log debug message
  ```
  **è§£å†³æ–¹æ³•**ï¼šå…ˆè°ƒç”¨`logger.remove()`ç§»é™¤é»˜è®¤çš„`sink`ï¼Œåœ¨æ‰§è¡Œ`logger.add()`æ·»åŠ è‡ªå·±çš„`sink`ã€‚
  **å‚è€ƒ**ï¼š
  https://github.com/Delgan/loguru/issues/208
  https://github.com/Delgan/loguru/issues/126

  ## è¯´æ˜
- ### `sink`
  sinkç±»ä¼¼äº`logging`é‡Œçš„`handler`ï¼Œç”¨äºæŒ‡å®šæ€ä¹ˆå¤„ç†logæ¶ˆæ¯
  æ”¯æŒä»¥ä¸‹å‡ ç§æ ¼å¼ï¼š
  - `file-like object`
    ç±»ä¼¼äº`sys.stderr` `open('test.log', "w")`è¿™ç§    
  - `str`æˆ–è€…`pathlib.Path`æ ¼å¼çš„`file path`
  - `callable`å¯è°ƒç”¨å‚æ•°
  - `coroutine funtion`åç¨‹æ–¹æ³•
  - `logging.Handler`
- ### log Level
  Logç­‰çº§è¡¨  
  Level name| Severity value| Logger method  
  :-: | :-: | :-: |  
  TRACE | 5 | `logger.trace()` |  
  DEBUG | 10 | `logger.debug()` |  
  INFO | 20 | `logger.info()` |  
  SUCCESS | 25 | `logger.success()` |  
  WARNING | 30 | `logger.warning()` |  
  ERROR | 40 | `logger.error()` |  
  CRITICAL | 50 | `logger.critical()` |  
- ### record dict
  recordæ˜¯ä¸€ä¸ªPythonå­—å…¸ï¼Œç”±sinksæ¥è®¿é—®ã€‚å®ƒåŒ…å«æ‰€æœ‰æ—¥å¿—è°ƒç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆä¾‹å¦‚æ—¶é—´ï¼Œè°ƒç”¨æ–¹æ³•ï¼Œè°ƒç”¨æ–‡ä»¶ï¼Œè°ƒç”¨è¡Œæ•°ï¼Œæ—¥å¿—ç­‰çº§ç­‰ç­‰ï¼‰
  å¦‚ä¸‹è¡¨ï¼Œä¸ºrecordçš„å…·ä½“ä¿¡æ¯ã€‚è‡ªå®šä¹‰sinkçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä¿¡æ¯ï¼Œæ¥è¿›è¡Œæ“ä½œã€‚  
  Key| Description| Attributes  
  :-: | :-: | :-: |  
  elapsed| ä»ç¨‹åºè¿è¡Œåˆ°ç°åœ¨çš„æ—¶é—´å·® | è¯¦è§`datetime.timedelta` |  
  exception| æ ¼å¼åŒ–çš„å¼‚å¸¸ä¿¡æ¯æˆ–None | `type`, `value`, `traceback` |  
  extra| The dict of attributes bound by the user (see bind()) | None|  
  file| å½“å‰æ–‡ä»¶å | `name` (default), `path`|  
  function| å½“å‰æ–¹æ³• | None|  
  level| log level | `name` (default), `no`, `icon`|  
  line| ä»£ç ç¬¬å¤šå°‘è¡Œ | None |  
  message| logå…·ä½“ä¿¡æ¯ | None|  
  module| å½“å‰module | None|  
  name| å½“å‰`__name__`| None|  
  process| å½“å‰è¿›ç¨‹ | `name`, `id` (default)|  
  thread| å½“å‰çº¿ç¨‹ | `name`, `id` (default)|  
  time| å½“å‰æœ¬åœ°æ—¶é—´ | è¯¦è§datetime.datetime|  


  ä¸‹é¢çš„ä»£ç å°†å±•ç¤ºrecordçš„å…·ä½“ä¿¡æ¯
  ```Python
  >>> from loguru import logger
  >>> import sys
  >>> logger.remove()
  >>> def show_record(record):
  ...     print(record)
  ...     return record
  ...
  >>> logger.debug("debug msg")
  >>> logger.add(sys.stdout, filter=show_record)
  1
  >>> logger.debug("debug msg")
  {'elapsed': datetime.timedelta(seconds=81, microseconds=247110), 'exception': None, 'extra': {}, 'file': (name='<stdin>', path='<stdin>'), 'function': '<module>', 'level': (name='DEBUG', no=10, icon='ğŸ'), 'line': 1, 'message': 'debug msg', 'module': '<stdin>', 'name': '__main__', 'process': (id=33552, name='MainProcess'), 'thread': (id=22128, name='MainThread'), 'time': datetime(2020, 6, 8, 14, 2, 55, 767312, tzinfo=datetime.timezone(datetime.timedelta(seconds=28800), '?D1Â¨Â²Â¡Ã€Â¨ÂºÂ¡Ã?Â¨ÂºÂ¡Ã€??'))}
  2020-06-08 14:02:55.767 | DEBUG    | __main__:<module>:1 - debug msg
  ```